<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>uHerd</title>
  
  <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/moment/min/moment.min.js"></script>
  <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
  <script type="text/javascript" src="bower_components/typeahead.js/dist/typeahead.jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/typeahead.js/dist/bloodhound.min.js"></script>  
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
  <link rel="stylesheet" href="uherd.css" />
</head>
<body>
    
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">uHerd</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    
    <div class="container">

      <div class="starter-template">
          <h1>Have uHerd?</h1>
        <p class="lead">Create an event and invite some friends!</p>
        <!--Add a button for the user to click to initiate auth sequence -->
            <button id="authorize-button" style="visibility: hidden">Log into Gmail</button>
            <div id="content"></div>
      </div>
    </div>

    <script type="text/javascript">

      var clientId = '270879350971-7k5qv54a09ip2k6cfsd5fpaksecuk4rl.apps.googleusercontent.com';

      var apiKey = 'AIzaSyCSxH_RPgku5PeahJo5LWuujGgmh-kplKo';

      var scopes = 'https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/gmail.readonly';

      function handleClientLoad() {
        // Step 2: Reference the API key
        gapi.client.setApiKey(apiKey);
        window.setTimeout(checkAuth,1);
      }

      function checkAuth() {
        gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
      }

      function handleAuthResult(authResult) {
        var authorizeButton = document.getElementById('authorize-button');
        if (authResult && !authResult.error) {
          authorizeButton.style.visibility = 'hidden';
          setupGooglePlusApi();
          setupGmailApi()
        } else {
          authorizeButton.style.visibility = '';
          authorizeButton.onclick = handleAuthClick;
        }
      }

      function handleAuthClick(event) {
        // Step 3: get authorization to use private data
        gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
        return false;
      }

      // Load the API and make an API call.  Display the results on the screen.
      function setupGooglePlusApi() {
        // Step 4: Load the Google+ API
        gapi.client.load('plus', 'v1').then(function() {
          // Step 5: Assemble the API request
          var request = gapi.client.plus.people.get({
            'userId': 'me'
          });
          // Step 6: Execute the API request
          request.then(function(resp) {
              console.log('Executing');
            var heading = document.createElement('h4');
            var image = document.createElement('img');
            image.src = resp.result.image.url;
            heading.appendChild(image);
            heading.appendChild(document.createTextNode(resp.result.displayName));

            document.getElementById('content').appendChild(heading);
          }, function(reason) {
            console.log('Error: ' + reason.result.error.message);
          });
        });
      }
      
      /**
       * Load Gmail API client library. List labels once client library
       * is loaded.
       */
      function setupGmailApi() {
        gapi.client.load('gmail', 'v1', listThreads);
      }

      /**
       * Print all Labels in the authorized user's inbox. If no labels
       * are found an appropriate message is printed.
       */
      function listLabels() {
        var request = gapi.client.gmail.users.labels.list({
          'userId': 'me'
        });

        request.execute(function(resp) {
          var labels = resp.labels;
          appendPre('Labels:');

          if (labels && labels.length > 0) {
            for (i = 0; i < labels.length; i++) {
              var label = labels[i];
              appendPre(label.name)
            }
          } else {
            appendPre('No Labels found.');
          }
        });
      }

      function getThreadSubject(thread)
      {
          if (thread.messages.length < 1)
              return 'zero-thread'
          var headers = thread.messages[0].headers;
          for (i = 0; i < headers.length; i++)
          {
              var header = headers[i];
              if (header.name == 'Subject')
              {
                  return header.value;
              }
          }
          return 'unknown'
      }
      /**
       * Print all threads with the keywords, or nothing at all
       *
       */
      function listThreads() {
          var userId = 'me';
          var query = 'youtube';
          var maxResults = '15';
          
          var callback = function(threads) {
              if (threads && threads.length > 0) {
                  appendPre('Threads (');
                  appendPre(threads.length);
                  appendPre('):');
                  for (i = 0; i < threads.length; i++) {
                      var thread = threads[i];
                      appendPre(thread.snippet)
                  }
              }
          }
          var getPageOfThreads = function(request, result) {
            request.execute(function (resp) {
              result = result.concat(resp.threads);
              var nextPageToken = resp.nextPageToken;
              if (nextPageToken && result.length < maxResults) {
                request = gapi.client.gmail.users.threads.list({
                  'userId': userId,
                  'q': query,
                  'pageToken': nextPageToken,
                    'maxResults': maxResults
                });
                getPageOfThreads(request, result);
              } else {
                callback(result);
              }
            });
          };
          var request = gapi.client.gmail.users.threads.list({
            'userId': userId,
            'maxResults': maxResults,
            'q': query
          });
          getPageOfThreads(request, []);
      }
      /**
       * Append a pre element to the body containing the given message
       * as its text node.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('threads');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }
      
    </script>
      
<!--    // Step 1: Load JavaScript client library -->
    <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
</div>
    
          <div class='col-sm-6'>
              <div class="form-group">
                  <label for="dateTime">Date & Time</label>
                  <div class='input-group date' id='datetimepicker1'>
                      <input type='text' class="form-control" id="uHerdDateTime"/>
                      <span class="input-group-addon">
                          <span class="glyphicon glyphicon-calendar"></span>
                      </span>
                  </div>
              </div>
              <div class="form-group">
                  <label for="invitees">Invitees</label>
                  <input class="typeahead form-control" type="text" id="invitees" placeholder="My friends">
              </div>
              <button type="submit" class="btn btn-default">Submit</button>
          </div>
      
      <script type="text/javascript">
          $(function () {
              $('#datetimepicker1').datetimepicker();
              
              var planets = [ "Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune" ];
              var planets = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.whitespace,
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                  local: planets
              });
              
              $('#invitees').typeahead(
                  {
                    hint: true,
                    highlight: true,
                    minLength: 1
                  },
                  {
                    name: 'planets',
                    source: planets
                  }
              );
          });
      </script>

          <div class='col-sm-6'>
              <div id="threads"></div>
          </div>

</body>
</html>